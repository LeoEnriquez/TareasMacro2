---
title: "Ejercicio 2"
output:
  pdf_document: default
---
```{r librerias, include = FALSE}
library(stargazer)
library(kableExtra)
library(viridis)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
library(scales)
library(quantmod)
library(texreg)
library(tinytex)
```
## Ejercicio 2

Simule una variedad de agentes que tienen ingresos permanentes diferentes e ingresos transitorios diferentes y calcule la relación entre consumo e ingreso que resulta dada una variedad de supuestos para las varianzas de cada tipo de ingreso siguiendo estos pasos:[2 horas, 1 punto cada inciso].

### Ejercicio 2.a

**Cree un vector de 20 ingresos permanentes aleatorios $Y_i^P$, distribuidos normalmente, con media 10 y varianza $\sigma^P$. Cree 20 vectores (cada uno de estos vectores representa una persona) cada uno con 100 observaciones idénticas del ingreso permanente. Grafíquelos (eje x, persona; eje y, ingreso permanente).**

Se creó un vector de 20 observaciones distribuidas normalmente con media igual a diez y varianza de 4 que representan el ingreso permanente de 20 individuos, esto es: $\mu_{Y^P_{i}} = 10$ y $Var(Y^P_{i}) = 4$. Posteriormente, se construyó una matriz con 100 observaciones para cada individuo, siendo estas idénticas a su consumo permanente.

```{r INGRESO PERMANENTE, include = FALSE}
# Generación de una base de 20 ingresos permanente con media 10 y varianza positiva = 4
Yp_i <- rnorm(20, mean = 10, sd = 2)

#Generación de una matriz de ceros de 100 filas y 20 columnas
Yp <- matrix(0, nrow = 100, ncol = 20)

#Proceso para llenar la matriz Yp
#Ciclo definido para variar columnas, los datos de las 100 filas de cada columna serán sustituidas por el valor que le corresponda a i (donde i va de 1 a 20) de Yp_i

for (i in 1:20){
  Yp[,i] <- Yp_i[i]
}

colnames(Yp) <- c(paste0(1:20))
rownames(Yp) <- c(1:100)
```

Así, la siguiente gráfica muestra el ingreso permanente de 20 individuos, donde puede observarse que todas las observaciones se encuentran alrededor del valor de 10, dado que $\mu_{Y^P_{i}} = 10$.

```{r VECTOR INGRESO PERMANENTE, echo=FALSE}

#Yp1 <- Yp[1,, drop = FALSE]
```

```{r GRÁFICA INGRESO PERMANENTE, echo=FALSE}

GrafIngPerm <- barplot (Yp[1,], col = "blue", ylim = c(0, 20), main = "Gráfica 2.1. Ingreso permanente de 20 individuos", xlab = "Individuos", ylab = "Ingreso permanente en miles de pesos", cex.names = .7)
```
\newpage

### Ejercicio 2.b

**Cree 20 vectores de 100 ingresos transitorios aleatorios $Y_{i,t}^T$, distribuidos normalmente, con media 0 y con varianza $\sigma^T$. Grafíquelos.**

```{r INGRESO TRANSITORIO, include = FALSE}

Yt <- matrix( rnorm(100*20, mean = 0, sd = 2), 100, 20)

colnames(Yt) <- c(paste0(1:20))

```

Una vez creados los 20 vectores con 100 ingresos transitorios para cada individuo con $\mu_{Y^T_{i}} = 0$ y $Var(Y^T_{i}) = 4$, y con el objetivo de facilitar la representación gráfica, se presenta la primera observación para los 20 individuos, así como 100 observaciones para el primer individuo:

```{r INGRESO TRANSITORIO PROMEDIO, echo=FALSE}

#PromedioIngTrans <- colMeans(Yt)

#Yt1 <- t(as.data.frame(PromedioIngTrans))

#colnames(Yt1) <- c(paste0(1:20))
```


```{r GRÁFICO INGRESO TRANSITORIO PROMEDIO, echo = FALSE}

GrafIngTrans1 <- barplot (Yt[1,], col = "green", ylim = c(-5, 5), main = "Gráfica 2.2. Un ingreso transitorio de 20 individuos", xlab = "Individuos", ylab = "Ingreso transitorio en miles de pesos", cex.names = 0.7)

GrafIngTrans2 <- barplot (Yt[,1], col = "green", ylim = c(-7, 7), main = "Gráfica 2.3. 100 Ingresos transitorios para el individuo 1", xlab = "Ingresos transitorios aleatorios", ylab = "Miles de pesos", cex.names = 0.7)
```
\newpage

### Ejercicio 2.c

**Cree 20 vectores de 100 ingresos totales $Y_{i,t}$, sumando el ingreso transitorio y el permanente. Grafíquelos.**

Después de crear los 20 vectores aleatorios con 100 ingresos totales con base en la expresión $Y = Y^P + Y^T$, a continuación de muestran dos gráficas, una que exhibe la primera observación del ingreso total de los 20 individuos, y otra con 100 diferentes ingresos totales para el primer individuo:

```{r INGRESO TOTAL, echo = FALSE}

Y <- Yp + Yt

#PromedioIngTotal <- colMeans(Y)

#Y1 <- t(as.data.frame(PromedioIngTotal))

#colnames(Y1) <- c(paste0(1:20))
```

```{r GRÁFICA INGRESO TOTAL, echo = FALSE}

GrafIngTotal1 <- barplot (Y[1,], col = "purple", ylim = c(0, 20), main = "Gráfica 2.4. Un ingreso total de 20 individuos", xlab = "Individuos", ylab = "Ingreso total en miles de pesos", cex.names = 0.7)

GrafIngTotal2 <- barplot (Y[,1], col = "purple", ylim = c(0, 20), main = "Gráfica 2.5. 100 ingresos totales para el individuo 1", xlab = "Ingresos totales", ylab = "Miles de pesos", cex.names = 0.7)
```

Puede observarse que los valores del ingreso total para todos los individuos, $Y$, se mantienen alrededor del valor de 10, producto de la propiedad de linealidad de la esperanza: $E[Y] = E[Y^P] + E[Y^T] = 10 + 0 = 10$.

\newpage

### Ejercicio 2.d

**Cree 20 vectores de 100 errores de medición $\epsilon_{i,t}$, distribuidos normalmente, con media 0 y varianza $\sigma^\epsilon>0$. Grafíquelos.**

Se crearon 20 vectores con 100 errores cada uno, con media cero y varianza de 0.25, esto es: $\mu_{e_{i}} = 0$ y $Var(e_{i}) = 0.25$. Así, se presenta la primera observación de errores para los 20 individuos, así como 100 errores para el individuo 1:

```{r ERRORES, include=FALSE}

et <- matrix( rnorm(100*20, mean = 0, sd = 0.5), 100, 20)

colnames(et) <- c(paste0(1:20))


#ErrorPromedio <- colMeans(Et)

#Et1 <- t(as.data.frame(ErrorPromedio))

#colnames(Et1) <- c(paste0(1:20))
```

```{r GRÁFICA ERRORES , echo = FALSE}
GrafError1 <- barplot (et[1,], col = "red", ylim = c(-1.5, 1.5), main = "Gráfica 2.6. Un error de medición de 20 individuos", xlab = "Individuos", ylab = "Error promedio de medición en miles de pesos", cex.names = 0.7)

GrafError1 <- barplot (et[,1], col = "red", ylim = c(-1.5, 1.5), main = "Gráfica 2.7. 100 errores de medición para el individuo 1", xlab = "Errores aleatorios", ylab = "Miles de pesos", cex.names = 0.7)
```
\newpage

### Ejercicio 2.e

**Cree  20 vectores de 100 consumos $C_{i,t}$ cada uno, de acuerdo a la siguiente regla $C_{i,t}=Y_i^P+0.1Y_{i,t}^T+\epsilon_{i,t}$. Grafíquelos.**

Una vez calculados 100 diferentes consumos para cada uno de los 20 individuos, se graficó la primera observación para todos los individuos y todas las observaciones para el primer individuo:

```{r CONSUMO, include = FALSE}

Ct <- Yp + 0.1*(Yt) + et


#ConsumoPromedio <- colMeans(C)

#C1 <- t(as.data.frame(ConsumoPromedio))

#colnames(C1) <- c(paste0(1:20))
```

```{r GRAFICA CONSUMO, echo = FALSE}

barplot (Ct[1,], col = "#00FFFF", ylim = c(0, 16), main = "Gráfica 2.8. Un consumo de 20 individuos", xlab = "Individuos", ylab = "Consumo promedio en miles de pesos", cex.names = 0.7)

barplot (Ct[,1], col = "#00FFFF", ylim = c(0, 15), main = "Gráfica 2.9. 100 consumos para el individuo 1", xlab = "Individuos", ylab = "Consumo promedio en miles de pesos", cex.names = 0.7)
```
Dado que $C_{i,t}=Y_i^P+0.1Y_{i,t}^T+\epsilon_{i,t}$, entonces $E[C_{i,t}] = E[Y_i^P] + E[0.1Y_{i,t}^T] + E[\epsilon_{i,t}] = 10 + 0.1(0) + 0 = 10$, lo cual es consistente con las gráficas. 

\newpage

### Ejercicio 2.f

**Estime la relación lineal entre ingreso total y consumo $C_{i,t}=\alpha+\beta Y_{i,t}+\epsilon_{i,t}$. Describa el resultado de su estimación y grafíque la relación entre las observaciones del consumo y las del ingreso.**

Al realizar la regresión del modelo, puede observarse una relación positiva entre ambas variables. Además, hay una concentración de las observaciones más grande alrededor de los valores de 10 del Ingreso, lo cual es consistente con el hecho de que el Ingreso Total se compone del Ingreso Permanente (con media 10) y el Ingreso Transitorio (con media 0):

```{r REGRESIÓN, echo=F, message=FALSE, warning=FALSE, paged.print=FALSE}

scatter.smooth(x = Y, y = Ct, span = 1, main = "Gráfica 2.10. Relación entre el Consumo y el Ingreso", xlab = "Ingreso", ylab = "Consumo", col = "#333399", cex = 0.5)

#plot(x=Y, y=C, main = "Relación entre el Consumo y el Ingreso",
#     xlab = "Ingreso", ylab = "Consumo",
#     pch = 1, frame = T)

#abline(lm(C ~ Y), col = "blue")

#reg1 <- lm(C ~ Y)

#summary(reg1)

#coefficients(reg1)
```
\newpage

### Ejercicio 2.g

**Incremente la varianza del ingreso permanente, y disminuya la varianza del ingreso transitorio y vuelva a estimar y graficar la relación entre el consumo y el ingreso.**

```{r NUEVO INGRESO PERMANENTE, include = FALSE}

NYp_i <- rnorm(20, mean = 10, sd = 3)

NYp <- matrix(0, nrow = 100, ncol = 20)

for (i in 1:20){
  NYp[,i] <- NYp_i[i]
}

colnames(NYp) <- c(paste0(1:20))
rownames(NYp) <- c(1:100)
```

```{r NUEVO INGRESO TRANSITORIO, include = FALSE}

NYt <- matrix( rnorm(100*20, mean = 0, sd = 0.5), 100, 20)

colnames(NYt) <- c(paste0(1:20))
```

```{r NUEVO INGRESO TRANSITORIO PROMEDIO, echo=FALSE}

#PromedioNuevoIngTrans <- colMeans(NYt)

#NYt1 <- t(as.data.frame(PromedioNuevoIngTrans))

#colnames(NYt1) <- c(paste0(1:20))
```

```{r NUEVO INGRESO TOTAL, echo = FALSE}

NY <- NYp + NYt

#PromedioNuevoIngTotal <- colMeans(NY)

#NY1 <- t(as.data.frame(PromedioNuevoIngTotal))

#colnames(NY1) <- c(paste0(1:20))
```

```{r NUEVO CONSUMO, include = FALSE}

NCt <- NYp + 0.1*(NYt) + et


#NuevoConsumoPromedio <- colMeans(NC)

#NC1 <- t(as.data.frame(NuevoConsumoPromedio))

#colnames(NC1) <- c(paste0(1:20))
```

Hasta ahora, los valores de las varianzas del ingreso permanente y el transitorio eran, respectivamente: $Var(Y^P) = Var(Y^T) = 4$. Ahora, se utilizaron los valores $Var'(Y^P) = 9$ y $Var'(Y^T) = 0.25$. Una vez realizado el procedimiento de código correspondiente, se encontró la siguiente relación entre el Nuevo Consumo y el Nuevo Ingreso:

```{r REGRESIÓN 2, echo=FALSE}

scatter.smooth(x = NY, y = NCt, span = 1, main = "Gráfica 2.11. Relación entre el Consumo y el Ingreso.\n Varianza del ingreso permanente más alta y varianza del ingreso transitorio más baja.", xlab = "Ingreso", ylab = "Consumo", col = "#333399", cex = 0.5, cex.main = 1)

#reg2 <- lm(NC ~ NY)

#summary(reg2)

```
Donde se pueden observar dos características relevantes:

1. El intercepto de la función estimada para el segundo modelo $\hat{\alpha}$ **TAREA**.

2. Por otra parte, se observa que la concentración de observaciones es más compacta que en el caso anterior. Esto se debe a que la varianza del Ingreso Transitorio es más baja que antes, lo que implica una menor dispersión de los datos alrededor del modelo estimado. De hecho, ahora es mucho más visible que los puntos se encuentran cercanos a los niveles de 10 de ambas variables.

\newpage

### Ejercicio 2.h

**Disminuya la varianza del ingreso permanente, y aumente la varianza del ingreso transitorio y vuelva a estimar y graficar la relación entre el consumo y el ingreso.**

```{r NUEVO NUEVO INGRESO PERMANENTE, include = FALSE}

NNYp_i <- rnorm(20, mean = 10, sd = 0.5)

NNYp <- matrix(0, nrow = 100, ncol = 20)

for (i in 1:20){
  NNYp[,i] <- NNYp_i[i]
}

colnames(NNYp) <- c(paste0(1:20))
rownames(NNYp) <- c(1:100)
```

```{r NUEVO NUEVO INGRESO TRANSITORIO, include = FALSE}

NNYt <- matrix( rnorm(100*20, mean = 0, sd = 3), 100, 20)

colnames(NNYt) <- c(paste0(1:20))
```

```{r NUEVO NUEVO INGRESO TRANSITORIO PROMEDIO, echo=FALSE}

#PromedioNNuevoIngTrans <- colMeans(NNYt)

#NNYt1 <- t(as.data.frame(PromedioNNuevoIngTrans))

#colnames(NNYt1) <- c(paste0(1:20))
```

```{r NUEVO NUEVO INGRESO TOTAL, echo = FALSE}

NNY <- NNYp + NNYt

#PromedioNNuevoIngTotal <- colMeans(NNY)

#NNY1 <- t(as.data.frame(PromedioNNuevoIngTotal))

#colnames(NNY1) <- c(paste0(1:20))
```

```{r NUEVO NUEVO CONSUMO, include = FALSE}

NNCt <- NNYp + 0.1*(NNYt) + et


#NuevoConsumoPromedio <- colMeans(NC)

#NC1 <- t(as.data.frame(NuevoConsumoPromedio))

#colnames(NC1) <- c(paste0(1:20))
```

Hasta ahora, los valores de las varianzas del ingreso permanente y el transitorio eran, respectivamente: $Var(Y^P) = Var(Y^T) = 4$. Ahora, se utilizaron los valores $Var'(Y^P) = .25$ y $Var'(Y^T) = 9$. Una vez realizado el procedimiento de código correspondiente, se encontró la siguiente relación entre el Nuevo Consumo y el Nuevo Ingreso:

```{r REGRESIÓN 3, echo=FALSE}

reg3 <- scatter.smooth(x = NNY, y = NNCt, span = 1, main = "Gráfica 2.12. Relación entre el Consumo y el Ingreso.\n Varianza del ingreso permanente más alta y varianza del ingreso transitorio más baja.", xlab = "Ingreso", ylab = "Consumo", col = "#333399", cex = 0.5, cex.main = 1)

#reg3 <- lm(NNC ~ NNY)

#summary(reg3)

```

Donde se pueden observar dos características relevantes:

1. El intercepto de la función estimada para el segundo modelo $\hat{\alpha}$ **TAREA**.

2. Por otra parte, se observa que la concentración de observaciones es menos compacta que en el caso anterior. Esto se debe a que la varianza del Ingreso Transitorio es más alta que antes, lo que implica una mayor dispersión de los datos alrededor del modelo estimado. Además, la pendiente es menor.